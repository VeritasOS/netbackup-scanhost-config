# Scan host configuration using powershell
    Version: 1.0

## Description
- This utility installs and configures the prerequisites required to run a malware scan on the scan host (Windows Server 2016 and above).
- Additionally, this utility can be used to install `NetBackup Malware Scanner` on the scan host.
- The following would be installed/configured by the utility on the scan host
        <ul>
        <li> OpenSSH </li>
        <li> NFS-Client </li>
        <li> <a href="https://aka.ms/vs/17/release/vc_redist.x64.exe"> VC Runtime </a> </li>
        <li> Configurations: Non-administrator user creation </li>
        </ul>

## Steps to configure scan host
```
1. Clone the repository from GitHub and move it to your Scan Host:
    git clone https://github.com/VeritasOS/netbackup-scanhost-config.git
2. Provide the scan host details in the `inputs.json` file. Refer `Terminologies` section for the complete list of options.
3. Open powershell.exe as Administrator
4. Traverse to netbackup-scanhost-config\powershell\ (cd netbackup-scanhost-config\powershell\)
5. Run the following command
   .\configure-scanhost.ps1 --install
6. '--check' parameter can be used to only check the configurations on scan host (.\configure-scanhost.ps1 --check)
7. '--help'/'--h' parameter can be userd to check the usage and description of the utility
```

## Terminologies
| Parameter name            | Mandatory | Descripton                                                                                                                         |                                                       Default value                                                        |
| --------------------------|-----------|------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|
| openssh_download_url      |    Yes    | URL from which the OPENSSH package would be installed                                                                              | [OpenSSH-v9.4.0.0p1-Beta](https://github.com/PowerShell/Win32-OpenSSH/releases/download/v9.4.0.0p1-Beta/OpenSSH-Win64.zip) |
| vcruntime_download_url    |    Yes    | URL from which the VCRuntime package would be installed                                                                            | [VCRuntime](https://aka.ms/vs/17/release/vc_redist.x64.exe)                                                                |
| openssh_installation_path |    No     | Path at which OPENSSH would be installed                                                                                           | C:\OpenSSH                                                                                                                 |
| scan_user                 |    Yes    | The user will be created if it does not exist on the scan host and NetBackup Malware Scanner will be configured using the same user| scanuser                                                                                                                   |
| scan_user_password        |    Yes    | This would be the password for `scan_user`, if not provided then password would not be set                                         | P@ssw0rd321#1                                                                                                              |
| scan_group                |    Yes    | The group will be created if it does not exist on the scan host and scan scanuser will be added to this group                      | scangroup                                                                                                                  |
| avira_package_path        |    No     | Local absolute path of the NetBackup Malware Scanner package                                                                       |                                                                                                                            |
| avira_installation_path   |    No     | Path at which NetBackup Malware Scanner would be installed                                                                         | C:\Avira                                                                                                                   |
| scan_vm_backup            |    Yes    | Scan host should be used for scanning VM backup images (1 = VM backup images, 0 = Others)                                          | 0                                                                                                                          |

## Notes
- Logs of the execution can be found in config.log file which is generated by the script while installation.
- If the user specified in inputs.json already exists on the host, password for the user will be updated.
- If passwd/group file already exists, backup copy of the file will be created and current file will be overwritten. (e.g. passwd_04-12-2024-18.04.35.bak)
- Firewall rule will be added for sshd service on port **22**